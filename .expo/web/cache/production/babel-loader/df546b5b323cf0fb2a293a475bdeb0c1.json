{"ast":null,"code":"import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from'react';import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import TextInput from\"react-native-web/dist/exports/TextInput\";import KeyboardAvoidingView from\"react-native-web/dist/exports/KeyboardAvoidingView\";import FlatList from\"react-native-web/dist/exports/FlatList\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Text from\"react-native-web/dist/exports/Text\";import View from\"react-native-web/dist/exports/View\";import Image from\"react-native-web/dist/exports/Image\";import{f,auth,database,storage}from\"../../config/config\";import UserAuth from\"../components/auth\";var comment=function(_React$Component){_inherits(comment,_React$Component);var _super=_createSuper(comment);function comment(props){var _this;_classCallCheck(this,comment);_this=_super.call(this,props);_this.checkParams=function(){var params=_this.props.navigation.state.params;if(params){if(params.userId){_this.setState({userId:params.photoId});_this.fetchComments(params.userId);}}};_this.addCommentToList=function(comments_list,data,comment){var that=_assertThisInitialized(_this);var commentObj=data[comment];database.ref('users').child(commentObj.author).child('username').once('value').then(function(snapshot){var exists=snapshot.val!=null;if(exists)data=snapshot.val();comments_list.push({id:comment,comment:commentObj.comment,posted:that.timeConverter(commentObj.posted),author:data,authorId:comment.author});that.setState({refresh:false,loading:false});}).catch(function(error){return console.log(error);});};_this.fetchComments=function(photoId){var that=_assertThisInitialized(_this);database.ref('comments').child(photoId).orderByChild('posted').once('value').then(function(snapshot){var exists=snapshot.val()!==null;if(exists){data=snapshot.val();var comments_list=that.state.comments_list;for(var comment in data){that.addCommentToList(comments_list,data,comment);}}else{TouchList.setState({comments_list:[]});}}).catch(function(error){return console.log(error);});};_this.s4=function(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1);};_this.uniqueId=function(){return _this.s4()+_this.s4()+\"-\"+_this.s4()+\"-\"+_this.s4()+\"-\"+_this.s4()+\"-\"+_this.s4()+\"-\"+_this.s4()+\"-\"+_this.s4();};_this.pluralCheck=function(s){if(s==1){return' ago';}else{return's ago';}};_this.timeConverter=function(timestamp){var a=new Date(timestamp*1000);var seconds=Math.floor((new Date()-a)/1000);var interval=Math.floor(seconds/3153600);if(interval>1){return interval+'year'+_this.pluralCheck(interval);}interval=Math.floor(seconds/2592000);if(ivterval>1){return interval+'Month'+_this.pluralCheck(interval);}interval=Math.floor(seconds/86400);if(ivterval>1){return interval+'Day'+_this.pluralCheck(interval);}interval=Math.floor(seconds/3600);if(ivterval>1){return interval+'Hour'+_this.pluralCheck(interval);}interval=Math.floor(seconds/60);if(ivterval>1){return interval+'minute'+_this.pluralCheck(interval);}return Math.floor(seconds)+'second'+_this.pluralCheck(seconds);};_this.componentDidMount=function(){var that=_assertThisInitialized(_this);f.auth().onAuthStateChanged(function(user){if(user){that.setState({loggedin:true});}else{that.setState({loggedin:false});}});_this.checkParams();};_this.postComment=function(){var comment=_this.state.comment;if(comment!=''){var imageId=_this.state.photoId;var userId=f.auth().currentUser.uid;var commentId=_this.uniqueId();var dateTime=Date.now();var timestamp=Math.floor(dateTime/1000);_this.setState({comment:''});var commentObj={posted:timestamp,author:userId,comment:comment};database.ref('/comments/'+'/'+commentId).set(commentObj);}else{alert('Please enter any comment');}};_this.reloadComment=function(){_this.setState({comments_list:[]});_this.fetchComments(_this.state.photoId);};_this.state={loggedin:false,comments_list:[]};return _this;}_createClass(comment,[{key:\"render\",value:function render(){var _this2=this;return React.createElement(View,{style:{flex:1}},React.createElement(View,{style:{flexDiection:'row',height:70,paddingTop:30,backgroundColor:'white',borderColor:0.5,justifyContent:'center',justifyContent:'space-between',alignItems:'center'}},React.createElement(TouchableOpacity,{style:{width:100},onPress:function onPress(){return _this2.props.navigation.goBack();}},React.createElement(Text,{style:{fontSize:12,fontWeight:'bold',paddingLeft:10}},\"Go Back\")),React.createElement(Text,null,\"Comments\"),React.createElement(Text,{style:{width:100}},\"?\")),this.state.comments_list.length==0?React.createElement(Text,null,\"No comments\"):React.createElement(FlatList,{refreshing:this.this.state.comments_list,keyExtractor:function keyExtractor(item,index){return index.toString();},style:{flex:1,backgroundColor:'#eee'},renderItem:function renderItem(_ref){var item=_ref.item,index=_ref.index;return React.createElement(View,{key:index,style:{width:'100%',overflow:'hidden',marginBottom:5,justifyContent:'space-between',borderBottomWidth:1,borderColor:'grey'}},React.createElement(View,{style:{padding:5,width:'100%',flexDirection:'row',justifyContent:''}},React.createElement(Text,null,item.posted),React.createElement(TouchableOpacity,{onPress:function onPress(){return _this2.props.navigation.navigatte('user',{userId:item.authorId});}},React.createElement(Text,null,item.author))),React.createElement(View,{style:{padding:5}},React.createElement(Text,null,item.comment)));}}),this.state.loggedin==true?React.createElement(KeyboardAvoidingView,{behavior:\"padding\",enabled:true,style:{borderTopColor:'grey',borderWidth:1,padding:10,marginBottom:15}},React.createElement(Text,{style:{fontWeight:'bold'}},\"Post comment\"),React.createElement(View,null,React.createElement(TextInput,{editable:true,placeholder:'enter your comment here...',onChangeText:function onChangeText(text){return _this2.setState({comment:text});},value:this.state.comment,style:{marginVertical:10,height:50,padding:5,borderColor:'white',borderRadius:3,color:'black'}}),React.createElement(TouchableOpacity,{onPress:function onPress(){return _this2.postComment();},style:{paddingHorizontal:10,paddingVertical:10,backgroundColor:'blue',borderRadius:5}},React.createElement(Text,{style:{color:'white'}},\"Post\")))):React.createElement(UserAuth,{message:\"Please login to comment\",moveScreen:true,navigation:this.props.navigation}));}}]);return comment;}(React.Component);export default comment;","map":{"version":3,"sources":["E:/photofeed/app/screens/comments.js"],"names":["React","f","auth","database","storage","UserAuth","comment","props","checkParams","params","navigation","state","userId","setState","photoId","fetchComments","addCommentToList","comments_list","data","that","commentObj","ref","child","author","once","then","snapshot","exists","val","push","id","posted","timeConverter","authorId","refresh","loading","catch","error","console","log","orderByChild","TouchList","s4","Math","floor","random","toString","substring","uniqueId","pluralCheck","s","timestamp","a","Date","seconds","interval","ivterval","componentDidMount","onAuthStateChanged","user","loggedin","postComment","imageId","currentUser","uid","commentId","dateTime","now","set","alert","reloadComment","flex","flexDiection","height","paddingTop","backgroundColor","borderColor","justifyContent","alignItems","width","goBack","fontSize","fontWeight","paddingLeft","length","this","item","index","overflow","marginBottom","borderBottomWidth","padding","flexDirection","navigatte","borderTopColor","borderWidth","text","marginVertical","borderRadius","color","paddingHorizontal","paddingVertical","Component"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport {TouchableOpacity,TextInput,KeyboardAvoidingView,FlatList,StyleSheet,Text,View,Image} from 'react-native';\r\nimport {f,auth,database,storage} from '../../config/config';\r\nimport UserAuth from '../components/auth';\r\n\r\n\r\nclass comment extends React.Component{\r\n\r\n    constructor(props){\r\n        super(props);\r\n        this.state = {\r\n            loggedin: false,\r\n            comments_list:[]\r\n        }\r\n        \r\n    }\r\n\r\n    checkParams = () => {\r\n        //\r\n        var params = this.props.navigation.state.params;\r\n        if(params){\r\n            if(params.userId){\r\n                this.setState({\r\n                    userId:params.photoId\r\n                });\r\n                this.fetchComments(params.userId);\r\n            }\r\n        }\r\n    }\r\n\r\n    addCommentToList = (comments_list,data,comment) => {\r\n        var that = this;\r\n        var commentObj=data[comment];\r\n        database.ref('users').child(commentObj.author).child('username').once('value').then(function(snapshot){\r\n            \r\n            const exists = (snapshot.val !=null);\r\n            if(exists) data =snapshot.val();\r\n\r\n                comments_list.push({\r\n                    id:comment,\r\n                    comment:commentObj.comment,\r\n                    posted:that .timeConverter(commentObj.posted),\r\n                    author:data,\r\n                    authorId:comment.author\r\n                });\r\n                that.setState({\r\n                    refresh:false,\r\n                    loading:false\r\n                });\r\n\r\n        }).catch(error => console.log(error));\r\n    }\r\n\r\n    fetchComments = (photoId) => {\r\n        var that= this;\r\n        database.ref('comments').child(photoId).orderByChild('posted').once('value').then(function(snapshot){\r\n            const exists = (snapshot.val()!== null);\r\n            if(exists){\r\n                data =snapshot.val();\r\n                var comments_list= that.state.comments_list;\r\n\r\n                for(var comment in data){\r\n                    that.addCommentToList(comments_list,data,comment);\r\n                }\r\n\r\n            }else{\r\n                TouchList.setState({\r\n                    comments_list:[]\r\n                })\r\n            }\r\n        }).catch(error => console.log(error));\r\n    }\r\n\r\n\r\n    s4 = () => {\r\n        return Math.floor((1 + Math.random()) * 0x10000)\r\n          .toString(16)\r\n          .substring(1);\r\n      };\r\n      uniqueId = () => {\r\n        return (\r\n          this.s4() + this.s4() + \"-\" + this.s4() + \"-\" + this.s4() + \"-\" + this.s4() + \"-\" + this.s4() + \"-\" + this.s4() + \"-\" + this.s4()\r\n        );\r\n      };\r\n    pluralCheck = (s) => {\r\n        if(s==1){\r\n            return ' ago';\r\n        }else{\r\n            return 's ago';\r\n        }\r\n    }\r\n    timeConverter = (timestamp)=> {\r\n        var a = new Date(timestamp *1000);\r\n        var seconds  =Math.floor((new Date()-a)/1000);\r\n\r\n        var interval = Math.floor(seconds / 3153600);\r\n        if(interval>1){\r\n            return interval+ 'year'+this.pluralCheck(interval);\r\n        }\r\n        interval=Math.floor(seconds/ 2592000);\r\n        if(ivterval>1){\r\n            return interval+ 'Month'+this.pluralCheck(interval);\r\n        }\r\n        interval=Math.floor(seconds/ 86400);\r\n        if(ivterval>1){\r\n            return interval+ 'Day'+this.pluralCheck(interval);\r\n        }\r\n        interval=Math.floor(seconds/ 3600);\r\n        if(ivterval>1){\r\n            return interval+ 'Hour'+this.pluralCheck(interval);\r\n        }\r\n        interval=Math.floor(seconds/ 60);\r\n        if(ivterval>1){\r\n            return interval+ 'minute'+this.pluralCheck(interval);\r\n        }\r\n        return Math.floor(seconds)+ 'second'+this.pluralCheck(seconds);\r\n    }\r\n\r\n    componentDidMount = () => {\r\n        var that =this;\r\n        f.auth().onAuthStateChanged(function(user){\r\n            if(user){\r\n                //Logged in\r\n                that.setState({\r\n                    loggedin: true\r\n                })\r\n            }else{\r\n                //not Logged in\r\n                that.setState({\r\n                    loggedin: false\r\n                });\r\n            }\r\n        });\r\n        this.checkParams();\r\n    }\r\n\r\n    postComment=()=>{\r\n    \r\n        var comment = this.state.comment;\r\n        if(comment !=''){\r\n            var imageId=this.state.photoId;\r\n            var userId= f.auth().currentUser.uid;\r\n            var commentId = this.uniqueId();\r\n            var dateTime = Date.now();\r\n            var timestamp = Math.floor(dateTime/1000);\r\n\r\n            this.setState({\r\n                comment:''\r\n            });\r\n            var commentObj ={\r\n                posted:timestamp,\r\n                author:userId,\r\n                comment:comment\r\n            };\r\n\r\n            database.ref('/comments/'+'/'+commentId).set(commentObj);\r\n\r\n        }else{\r\n            alert('Please enter any comment');\r\n        }\r\n    }\r\n\r\n    reloadComment = () => {\r\n        this.setState({\r\n            comments_list: []\r\n        });\r\n        this.fetchComments(this.state.photoId);\r\n    }\r\n    \r\n    render(){\r\n        return(\r\n            <View style={{flex:1}}>\r\n                <View style={{flexDiection:'row',height:70,paddingTop:30,backgroundColor:'white',borderColor:0.5,justifyContent:'center',justifyContent:'space-between',alignItems:'center'}}>\r\n                            <TouchableOpacity \r\n                            style ={{width:100}}\r\n                            onPress={()=> this.props.navigation.goBack()} >\r\n                                <Text style ={{fontSize:12,fontWeight:'bold',paddingLeft:10}} >Go Back</Text>\r\n                            </TouchableOpacity>\r\n                            <Text>Comments</Text>\r\n                            <Text style ={{width:100}}>?</Text>\r\n\r\n                        </View>\r\n                        {this.state.comments_list.length == 0 ? (\r\n                            //no comment is there\r\n                            <Text>No comments</Text>\r\n                        ):(\r\n                            //are comments\r\n                        <FlatList \r\n                        refreshing={this.this.state.comments_list}\r\n                        keyExtractor={(item,index)=> index.toString()}\r\n                        style={{flex:1,backgroundColor:'#eee'}}\r\n                        renderItem={({item,index})=>(\r\n                            <View key={index} style={{width:'100%',overflow:'hidden',marginBottom:5,justifyContent:'space-between',borderBottomWidth:1,borderColor:'grey'}}>\r\n                                <View style={{padding:5,width:'100%',flexDirection:'row',justifyContent:''}}>\r\n                                    <Text>{item.posted}</Text>\r\n                                    <TouchableOpacity \r\n                                    onPress={()=> this.props.navigation.navigatte('user',{userId:item.authorId})}\r\n                                    >\r\n                                        <Text>{item.author}</Text>\r\n                                    </TouchableOpacity>\r\n                                </View>\r\n                                <View style={{padding:5}} >\r\n                                    <Text>{item.comment}</Text>\r\n                                </View>\r\n                            </View>\r\n                        )}\r\n                        />\r\n                        )}\r\n                { this.state.loggedin == true ? (\r\n                    //are logged in\r\n                    <KeyboardAvoidingView behavior='padding' enabled style={{borderTopColor:'grey',borderWidth:1,padding:10,marginBottom:15}} >\r\n                        <Text style={{fontWeight:'bold'}}>\r\n                            Post comment\r\n                        </Text>\r\n                        <View>\r\n                            <TextInput \r\n                            editable={true}\r\n                            placeholder={'enter your comment here...'}\r\n                            onChangeText={(text)=> this.setState({comment:text})}\r\n                            value={this.state.comment}\r\n                            style={{marginVertical:10,height:50,padding:5,borderColor:'white',borderRadius:3,color:'black'}}\r\n                            />\r\n                            <TouchableOpacity\r\n                            onPress={()=> this.postComment()}\r\n                            style={{paddingHorizontal:10,paddingVertical:10, backgroundColor:'blue',borderRadius:5}}>\r\n                                <Text style={{color:'white'}}>Post</Text>\r\n                            </TouchableOpacity>\r\n                        </View>\r\n                    </KeyboardAvoidingView>\r\n                ) : (\r\n                    //not logged in\r\n                    <UserAuth message={\"Please login to comment\"} moveScreen={true} navigation={this.props.navigation}  />    \r\n                )}\r\n\r\n             \r\n            </View>\r\n\r\n        )\r\n        \r\n    }\r\n}\r\n\r\nexport default comment;\r\n"]},"metadata":{},"sourceType":"module"}