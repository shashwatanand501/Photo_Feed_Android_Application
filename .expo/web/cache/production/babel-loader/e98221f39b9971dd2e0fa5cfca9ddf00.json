{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import React from'react';import Animated from\"react-native-web/dist/exports/Animated\";import Easing from\"react-native-web/dist/exports/Easing\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import View from\"react-native-web/dist/exports/View\";import invariant from\"../utils/invariant\";import NavigationScenesReducer from\"./ScenesReducer\";var DefaultTransitionSpec={duration:250,easing:Easing.inOut(Easing.ease),timing:Animated.timing};var Transitioner=function(_React$Component){_inherits(Transitioner,_React$Component);var _super=_createSuper(Transitioner);function Transitioner(props,context){var _this;_classCallCheck(this,Transitioner);_this=_super.call(this,props,context);_this._onLayout=function(event){var _event$nativeEvent$la=event.nativeEvent.layout,height=_event$nativeEvent$la.height,width=_event$nativeEvent$la.width;if(_this.state.layout.initWidth===width&&_this.state.layout.initHeight===height){return;}var layout=_objectSpread(_objectSpread({},_this.state.layout),{},{initHeight:height,initWidth:width,isMeasured:true});layout.height.setValue(height);layout.width.setValue(width);var nextState=_objectSpread(_objectSpread({},_this.state),{},{layout:layout});_this._transitionProps=buildTransitionProps(_this.props,nextState);_this.setState(nextState);};_this._onTransitionEnd=function(){if(!_this._isMounted){return;}var prevTransitionProps=_this._prevTransitionProps;_this._prevTransitionProps=null;var scenes=filterStale(_this.state.scenes);var nextState=_objectSpread(_objectSpread({},_this.state),{},{scenes:scenes});_this._transitionProps=buildTransitionProps(_this.props,nextState);_this.setState(nextState,function _callee(){var result;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!_this.props.onTransitionEnd){_context.next=5;break;}result=_this.props.onTransitionEnd(_this._transitionProps,prevTransitionProps);if(!(result instanceof Promise)){_context.next=5;break;}_context.next=5;return _regeneratorRuntime.awrap(result);case 5:if(_this._queuedTransition){_this._startTransition(_this._queuedTransition.nextProps,_this._queuedTransition.nextScenes,_this._queuedTransition.indexHasChanged);_this._queuedTransition=null;}else{_this._isTransitionRunning=false;}case 6:case\"end\":return _context.stop();}}},null,null,null,Promise);});};var _layout={height:new Animated.Value(0),initHeight:0,initWidth:0,isMeasured:false,width:new Animated.Value(0)};_this.state={layout:_layout,position:new Animated.Value(_this.props.navigation.state.index),progress:new Animated.Value(1),scenes:NavigationScenesReducer([],_this.props.navigation.state,null,_this.props.descriptors)};_this._prevTransitionProps=null;_this._transitionProps=buildTransitionProps(props,_this.state);_this._isMounted=false;_this._isTransitionRunning=false;_this._queuedTransition=null;return _this;}_createClass(Transitioner,[{key:\"componentDidMount\",value:function componentDidMount(){this._isMounted=true;}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this._isMounted=false;}},{key:\"componentWillReceiveProps\",value:function componentWillReceiveProps(nextProps){var nextScenes=NavigationScenesReducer(this.state.scenes,nextProps.navigation.state,this.props.navigation.state,nextProps.descriptors);if(!nextProps.navigation.state.isTransitioning){nextScenes=filterStale(nextScenes);}if(nextProps.screenProps!==this.props.screenProps){this.setState({nextScenes:nextScenes});}if(nextScenes===this.state.scenes){return;}var indexHasChanged=nextProps.navigation.state.index!==this.props.navigation.state.index;if(this._isTransitionRunning){this._queuedTransition={nextProps:nextProps,nextScenes:nextScenes,indexHasChanged:indexHasChanged};return;}this._startTransition(nextProps,nextScenes,indexHasChanged);}},{key:\"_startTransition\",value:function _startTransition(nextProps,nextScenes,indexHasChanged){var _this2=this;var nextState=_objectSpread(_objectSpread({},this.state),{},{scenes:nextScenes});var position=nextState.position,progress=nextState.progress;progress.setValue(0);this._prevTransitionProps=this._transitionProps;this._transitionProps=buildTransitionProps(nextProps,nextState);var toValue=nextProps.navigation.state.index;if(!this._transitionProps.navigation.state.isTransitioning){this.setState(nextState,function _callee2(){var result;return _regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:result=nextProps.onTransitionStart(_this2._transitionProps,_this2._prevTransitionProps);if(!(result instanceof Promise)){_context2.next=4;break;}_context2.next=4;return _regeneratorRuntime.awrap(result);case 4:progress.setValue(1);position.setValue(toValue);_this2._onTransitionEnd();case 7:case\"end\":return _context2.stop();}}},null,null,null,Promise);});return;}var transitionUserSpec=nextProps.configureTransition?nextProps.configureTransition(this._transitionProps,this._prevTransitionProps):null;var transitionSpec=_objectSpread(_objectSpread({},DefaultTransitionSpec),transitionUserSpec);var timing=transitionSpec.timing;delete transitionSpec.timing;var positionHasChanged=position.__getValue()!==toValue;var animations=indexHasChanged&&positionHasChanged?[timing(progress,_objectSpread(_objectSpread({},transitionSpec),{},{toValue:1})),timing(position,_objectSpread(_objectSpread({},transitionSpec),{},{toValue:nextProps.navigation.state.index}))]:[];this._isTransitionRunning=true;this.setState(nextState,function _callee3(){var result;return _regeneratorRuntime.async(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!nextProps.onTransitionStart){_context3.next=5;break;}result=nextProps.onTransitionStart(_this2._transitionProps,_this2._prevTransitionProps);if(!(result instanceof Promise)){_context3.next=5;break;}_context3.next=5;return _regeneratorRuntime.awrap(result);case 5:Animated.parallel(animations).start(_this2._onTransitionEnd);case 6:case\"end\":return _context3.stop();}}},null,null,null,Promise);});}},{key:\"render\",value:function render(){return React.createElement(View,{onLayout:this._onLayout,style:styles.main},this.props.render(this._transitionProps,this._prevTransitionProps));}}]);return Transitioner;}(React.Component);function buildTransitionProps(props,state){var navigation=props.navigation;var layout=state.layout,position=state.position,progress=state.progress,scenes=state.scenes;var scene=scenes.find(isSceneActive);invariant(scene,'Could not find active scene');return{layout:layout,navigation:navigation,position:position,progress:progress,scenes:scenes,scene:scene,index:scene.index};}function isSceneNotStale(scene){return!scene.isStale;}function filterStale(scenes){var filtered=scenes.filter(isSceneNotStale);if(filtered.length===scenes.length){return scenes;}return filtered;}function isSceneActive(scene){return scene.isActive;}var styles=StyleSheet.create({main:{flex:1}});export default Transitioner;","map":{"version":3,"sources":["E:/photofeed/node_modules/react-navigation-stack/dist/views/Transitioner.js"],"names":["React","invariant","NavigationScenesReducer","DefaultTransitionSpec","duration","easing","Easing","inOut","ease","timing","Animated","Transitioner","props","context","_onLayout","event","nativeEvent","layout","height","width","state","initWidth","initHeight","isMeasured","setValue","nextState","_transitionProps","buildTransitionProps","setState","_onTransitionEnd","_isMounted","prevTransitionProps","_prevTransitionProps","scenes","filterStale","onTransitionEnd","result","Promise","_queuedTransition","_startTransition","nextProps","nextScenes","indexHasChanged","_isTransitionRunning","Value","position","navigation","index","progress","descriptors","isTransitioning","screenProps","toValue","onTransitionStart","transitionUserSpec","configureTransition","transitionSpec","positionHasChanged","__getValue","animations","parallel","start","styles","main","render","Component","scene","find","isSceneActive","isSceneNotStale","isStale","filtered","filter","length","isActive","StyleSheet","create","flex"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Animated, Easing, StyleSheet, View } from 'react-native';\nimport invariant from '../utils/invariant';\n\nimport NavigationScenesReducer from './ScenesReducer';\n\n// Used for all animations unless overriden\nconst DefaultTransitionSpec = {\n  duration: 250,\n  easing: Easing.inOut(Easing.ease),\n  timing: Animated.timing\n};\n\n// eslint-disable-next-line react/no-deprecated\nclass Transitioner extends React.Component {\n  constructor(props, context) {\n    super(props, context);\n\n    // The initial layout isn't measured. Measured layout will be only available\n    // when the component is mounted.\n    const layout = {\n      height: new Animated.Value(0),\n      initHeight: 0,\n      initWidth: 0,\n      isMeasured: false,\n      width: new Animated.Value(0)\n    };\n\n    this.state = {\n      layout,\n      position: new Animated.Value(this.props.navigation.state.index),\n      progress: new Animated.Value(1),\n      scenes: NavigationScenesReducer([], this.props.navigation.state, null, this.props.descriptors)\n    };\n\n    this._prevTransitionProps = null;\n    this._transitionProps = buildTransitionProps(props, this.state);\n    this._isMounted = false;\n    this._isTransitionRunning = false;\n    this._queuedTransition = null;\n  }\n\n  componentDidMount() {\n    this._isMounted = true;\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  componentWillReceiveProps(nextProps) {\n    let nextScenes = NavigationScenesReducer(this.state.scenes, nextProps.navigation.state, this.props.navigation.state, nextProps.descriptors);\n    if (!nextProps.navigation.state.isTransitioning) {\n      nextScenes = filterStale(nextScenes);\n    }\n\n    // Update nextScenes when we change screenProps\n    // This is a workaround for https://github.com/react-navigation/react-navigation/issues/4271\n    if (nextProps.screenProps !== this.props.screenProps) {\n      this.setState({ nextScenes });\n    }\n\n    if (nextScenes === this.state.scenes) {\n      return;\n    }\n\n    const indexHasChanged = nextProps.navigation.state.index !== this.props.navigation.state.index;\n    if (this._isTransitionRunning) {\n      this._queuedTransition = { nextProps, nextScenes, indexHasChanged };\n      return;\n    }\n\n    this._startTransition(nextProps, nextScenes, indexHasChanged);\n  }\n\n  _startTransition(nextProps, nextScenes, indexHasChanged) {\n    const nextState = {\n      ...this.state,\n      scenes: nextScenes\n    };\n\n    const { position, progress } = nextState;\n\n    progress.setValue(0);\n\n    this._prevTransitionProps = this._transitionProps;\n    this._transitionProps = buildTransitionProps(nextProps, nextState);\n\n    const toValue = nextProps.navigation.state.index;\n\n    if (!this._transitionProps.navigation.state.isTransitioning) {\n      this.setState(nextState, async () => {\n        const result = nextProps.onTransitionStart(this._transitionProps, this._prevTransitionProps);\n        if (result instanceof Promise) {\n          await result;\n        }\n        progress.setValue(1);\n        position.setValue(toValue);\n        this._onTransitionEnd();\n      });\n      return;\n    }\n\n    // get the transition spec.\n    const transitionUserSpec = nextProps.configureTransition ? nextProps.configureTransition(this._transitionProps, this._prevTransitionProps) : null;\n\n    const transitionSpec = {\n      ...DefaultTransitionSpec,\n      ...transitionUserSpec\n    };\n\n    const { timing } = transitionSpec;\n    delete transitionSpec.timing;\n\n    const positionHasChanged = position.__getValue() !== toValue;\n\n    // if swiped back, indexHasChanged == true && positionHasChanged == false\n    const animations = indexHasChanged && positionHasChanged ? [timing(progress, {\n      ...transitionSpec,\n      toValue: 1\n    }), timing(position, {\n      ...transitionSpec,\n      toValue: nextProps.navigation.state.index\n    })] : [];\n\n    // update scenes and play the transition\n    this._isTransitionRunning = true;\n    this.setState(nextState, async () => {\n      if (nextProps.onTransitionStart) {\n        const result = nextProps.onTransitionStart(this._transitionProps, this._prevTransitionProps);\n\n        if (result instanceof Promise) {\n          await result;\n        }\n      }\n      Animated.parallel(animations).start(this._onTransitionEnd);\n    });\n  }\n\n  render() {\n    return <View onLayout={this._onLayout} style={styles.main}>\n        {this.props.render(this._transitionProps, this._prevTransitionProps)}\n      </View>;\n  }\n\n  _onLayout = event => {\n    const { height, width } = event.nativeEvent.layout;\n    if (this.state.layout.initWidth === width && this.state.layout.initHeight === height) {\n      return;\n    }\n    const layout = {\n      ...this.state.layout,\n      initHeight: height,\n      initWidth: width,\n      isMeasured: true\n    };\n\n    layout.height.setValue(height);\n    layout.width.setValue(width);\n\n    const nextState = {\n      ...this.state,\n      layout\n    };\n\n    this._transitionProps = buildTransitionProps(this.props, nextState);\n    this.setState(nextState);\n  };\n\n  _onTransitionEnd = () => {\n    if (!this._isMounted) {\n      return;\n    }\n    const prevTransitionProps = this._prevTransitionProps;\n    this._prevTransitionProps = null;\n\n    const scenes = filterStale(this.state.scenes);\n\n    const nextState = {\n      ...this.state,\n      scenes\n    };\n\n    this._transitionProps = buildTransitionProps(this.props, nextState);\n\n    this.setState(nextState, async () => {\n      if (this.props.onTransitionEnd) {\n        const result = this.props.onTransitionEnd(this._transitionProps, prevTransitionProps);\n\n        if (result instanceof Promise) {\n          await result;\n        }\n      }\n\n      if (this._queuedTransition) {\n        this._startTransition(this._queuedTransition.nextProps, this._queuedTransition.nextScenes, this._queuedTransition.indexHasChanged);\n        this._queuedTransition = null;\n      } else {\n        this._isTransitionRunning = false;\n      }\n    });\n  };\n}\n\nfunction buildTransitionProps(props, state) {\n  const { navigation } = props;\n\n  const { layout, position, progress, scenes } = state;\n\n  const scene = scenes.find(isSceneActive);\n\n  invariant(scene, 'Could not find active scene');\n\n  return {\n    layout,\n    navigation,\n    position,\n    progress,\n    scenes,\n    scene,\n    index: scene.index\n  };\n}\n\nfunction isSceneNotStale(scene) {\n  return !scene.isStale;\n}\n\nfunction filterStale(scenes) {\n  const filtered = scenes.filter(isSceneNotStale);\n  if (filtered.length === scenes.length) {\n    return scenes;\n  }\n  return filtered;\n}\n\nfunction isSceneActive(scene) {\n  return scene.isActive;\n}\n\nconst styles = StyleSheet.create({\n  main: {\n    flex: 1\n  }\n});\n\nexport default Transitioner;"]},"metadata":{},"sourceType":"module"}